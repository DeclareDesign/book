# Regression discontinuity designs {.unnumbered}

```{r}
#| echo: false
#| include: false
#| purl:  false
source("scripts/before_chapter_script.R")
```

:::: {.ddbox}

We declare a design in which the assignment of a treatment is determined by whether a characteristic of a unit exceeds a certain threshold value. We demonstrate through diagnosis the bias-variance tradeoff at the heart of the choice of answer strategies that target the local average treatment effect inquiry, defined right at the cutoff.

::::

Regression discontinuity designs exploit substantive knowledge that treatment is assigned in a particular way: everyone above a threshold is assigned to treatment and everyone below it is not. Even though researchers do not control the assignment, substantive knowledge about the threshold serves as a basis for a strong causal identification claim.

Thistlewhite and Campbell introduced the regression discontinuity design in the 1960s to study the impact of scholarships on academic success [@thistlethwaite1960regression]. Their insight was that students with a test score just above a scholarship cutoff were plausibly comparable to students whose scores were just below the cutoff, so any differences in future academic success could be attributed to the scholarship itself.

Just like instrumental variables, regression discontinuity designs identify a local average treatment effect: in this case, the average effect of treatment local to the cutoff. The main trouble with the design is the vanishing amount of data available as we approach the cutoff, so any answer strategy needs to use data that is some distance away from the cutoff. The further away from the cutoff we move, the larger the threat of bias because units become less and less similar.

Regression discontinuity designs have four components: a running variable $X$, a cutoff, a treatment variable $D$, and an outcome $Y$. The cutoff determines which units are treated depending on the value of the running variable. The running variable might be the Democratic party's margin of victory at time $t-1$, and the treatment $D$ might be whether the Democratic party won the election in time $t-1$. The outcome $Y$ might be the Democratic vote margin at time $t$. 
    
A major assumption required for the regression discontinuity design is that the conditional expectation functions --- functions that define the expected value of the outcome at every level of the running variable --- for both treatment and control potential outcomes are continuous at the cutoff.^[An alternative motivation for some designs that do not rely on continuity at the cutoff is called "local randomization".] 

The regression discontinuity design is closely related to the selection-on-observables design in that exact knowledge of the assignment mechanism is needed. In Figure @fig-ch16num8, we illustrate the DAG for the RD design, which includes a treatment with a known assignment mechanism (that units with $X>\mathrm{cutoff}$ are treated and those below are not). The running variable $X$, is a common cause both of treatment and the outcome, and so must be adjusted for (indicated by the dashed box) in order to identify the effect of treatment on the outcome and avoid confounding bias.  

![Directed acyclic graph for the regression discontinuity design.](/figures/figure-16-8){#fig-ch16num8}

Figure @fig-ch16num9 illustrates the major features of the model for the regression discontinuity using simulated data. The untreated units (blue points) are plotted to the left of the cutoff (vertical line), and the treated units (red points) are plotted to the right. The true conditional expectation functions for both the treated and untreated potential outcomes are displayed as colored lines, dashed where they are unobservable and solid where they are observable. 

![Data from a regression discontinuity design. On the x-axis is the running variable, which defines the cut off between control (here, below 0 on the running variable) and treatment (above 0). The outcome Y is on the y-axis. We illustrate smooth potential outcomes by showing the observed data curve (solid) and the counterfactual potential outcome (dashed).](/figures/figure-16-9){#fig-ch16num9}

The inquiry in a regression discontinuity design is the effect of the treatment exactly at the cutoff. Formally, it is the difference in the conditional expectation functions of the control and treatment potential outcomes when the running variable is exactly zero. The black vertical line in the plot shows this difference.

The data strategy is to collect the outcome data for all units within a interval (bandwidth) around the cutoff. The choice of bandwidth involves a tradeoff between bias and variance. The wider we make the bandwidth, the more data we have, and thus the more precision we may be able to achieve. However, the claim of causal identification comes from the comparability of units *just* above and *just* below the threshold. Units far from the cutoff are not likely to be comparable: at a minimum they differ in their values of the running variable and if that is correlated with other unobserved heterogeneity then they may differ in that too. Thus, the more units we compare further from the threshold, the more likely we are to induce bias in our estimates of the treatment effect. The ultimate bandwidth chosen for analysis is a function of the data collected in the data strategy and the bandwidth chosen in the answer strategy, which is often the output of an automated process.

::: {#def-ch16num5} 

## Regression discontinuity design

```{r, file = "scripts_declarations/declaration_16.5.R"}
```

:::

Regression discontinuity answer strategies approximate the treated and untreated conditional expectation functions to the left and right of the cutoff. The choice of answer strategy involves two key choices: the bandwidth of data around the threshold that is used for estimation, and the model used to fit that data. We declare the local polynomial regression discontinuity estimator with the robust bias-corrected inference procedures described in @calonico2014robust, which fits a nonparametric model to the data and chooses an optimal bandwidth that minimizes bias. This robust estimator is now widely used in practice, because it navigates the bias-variance tradeoff in selecting bandwidths and statistical model specifications in a data-driven manner. The procedure also obviates the need for researchers to select these parameters themselves.

Figure @fig-ch16num10 illustrates the tradeoff in bandwidth selection for a one-degree polynomial (linear interaction). We see the bias-variance tradeoff directly. The bias increases the wider the bandwidth and the more we are relying on data further from the threshold whereas the variance (here, the standard deviation of the estimates) is decreasing the more data we add by widening the bandwidth.

::: {#def-ch16num6} 

## Regression discontinuity designs with varying bandwidths

```{r, file = "scripts_declarations/declaration_16.6.R"}
```

:::

::: {#lem-ch16num5} 

## Regression discontinuity diagnosis across varying bandwidths

```{r}
#| eval: false

diagnosis_16.5 <- 
  declaration_16.6 |> 
  redesign(bandwidth = seq(from = 0.05, to = 0.5, by = 0.05)) |> 
  diagnose_designs
```

![Bias-variance tradeoff in bandwidth selection for the regression discontinuity design.](/figures/figure-16-10){#fig-ch16num10}

:::

## Design examples

- @Kirkland2021 uses a regression discontinuity design to estimate the effect of just electing a mayor with a business background on infrastructure and redistribution spending.

- @carnegie2017international uses a regression discontinuity design to compare countries that are just-eligible for lender status to those that are just-ineligible on human rights and democracy policies. 

