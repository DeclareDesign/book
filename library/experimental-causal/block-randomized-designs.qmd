# Block-randomized experiments {.unnumbered}

```{r}
#| echo: false
#| include: false
#| purl:  false
source("scripts/before_chapter_script.R")
```

:::: {.ddbox}
We declare a block-randomized trial in which subjects are assigned to treatment and control conditions within groups. We use design diagnosis to assess the reductions in variance in estimation that can be achieved from block randomization.        
::::

In a block-randomized experimental design, homogeneous sets of units are grouped together into blocks on the basis of covariates. The ideal blocking would group together units with identical potential outcomes, but since we don't have access to any outcome information at the moment of treatment assignment, let alone the full set of potential outcomes, we have to make do grouping together units on the basis of covariates we hope are strongly correlated with potential outcomes. The stronger the correlation between blocking variable and the potential outcomes, the more effective the blocking in terms of increasing precision.

Blocks can be formed in many ways. The can be constructed based on the levels of a single discrete covariate. We might be able to do better by blocking on the intersection of the levels of two discrete covariates. We could coarsen a continuous variable in order to create strata. We could even create matched quartets of units, partitioning the sample into sets of four units that are as similar as possible on many covariates. In any of these cases, we then randomize units *within* blocks to treatment. All of these procedures fall under the rubric of block random assignment. Methodologists have crafted many algorithms for creating blocks, each with their own tradeoffs in terms of computational speed and efficiency guarantees. 

In declaration @def:declaration-18-4, we block our assignment on a binary covariate `X`. We assign different fractions of each block to treatment to illustrate the notion that probabilities of assignment need not be constant across blocks, and if they aren't, we need to weight units by the inverse of the probability of assignment to the condition that they are in. In the answer strategy, we adjust for blocks using the @lin2013agnostic regression adjustment estimator including IPW weights. 

:::{.definition #declaration-18-4} 

Block randomized two arm trial design

```{r, file = "scripts_declarations/declaration_18.4.R"}
```

:::

## Why does blocking help?

Why does blocking increase the precision with which we estimate the ATE? One piece of intuition is that blocking rules out "bad" random assignments that exhibit imbalance on the blocking variable. If $N$ = 12 and $m$ = 6, complete random assignment allows `choose(12, 6) = 924` possible permutations. If we form two blocks of six units and conduct block random assignment, then there are `choose(6, 3) * choose(6, 3) = 400` remaining possible assignments. The assignments that are ruled are those in which too many or too few units in a block are assigned to treatment, because blocking requires that exactly $m_B$ units be treated in each block $B$. When potential outcomes are correlated with the blocking variable, those "extreme" assignments produce estimates that are in the tails of the sampling distribution associated with complete random assignment.^[One mistake sometimes made by new experimenters is to conduct *simple* random assignment within each block -- none of the gains from blocking described here apply if simple random assignment is conducted in each block, because that procedure produces the identical randomization distribution as a simple random assignment procedure without any blocking (provided that the probability of assignment is the same in each block).]

:::{.lemma #diagnosis-18-4}

Diagnosis comparing block random assignment and complete random assignment

This intuition behind blocking is illustrated in Figure @fig-figure-18-4, which shows the sampling distribution of the difference-in-means estimator under *complete* random assignment. The histogram is shaded according to whether the particular random assignment is permissible under a procedure that blocks on the binary covariate $X$. The sampling distribution of the estimator among the set of assignments that are permissible under blocking is more tightly distributed around the true average treatment effect than the estimates associated with assignments that are not perfectly balanced. Here we can see the value of a blocking procedure -- it *it rules out by design* those assignments that are not perfectly balanced. 

![Sampling distribution under complete random assignment, by covariate balance](/figures/figure-18-4){#fig:figure-18-4}

:::
 
## Design examples

- @Kalla2018 conduct an audit experiment among legislators in which the gender of a student asking for advice about starting a career in politics was randomized. Units were block-randomized into treatments on the basis the legislators own gender and their state.

- @lyall_zhou_imai_2020 use a block-randomized design to evaluate the effect of vocational training and cash transfers on support for combatants among youth in Afghanistan. Matched quartet blocks were created on the basis of district, gender, employment status, displacement status, and exposure to violence.

