<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Research Design in the Social Sciences - 19&nbsp; Complex designs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../lifecycle/" rel="next">
<link href="../library/experimental-causal.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><style type="text/css" media="print">
    body { visibility: hidden; display: none }
</style>
<script type="text/javascript">
    function createCookie(name, value, days) {
        var expires;
        if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (7 * 24 * 60 * 60 * 1000));
            expires = "; expires=" + date.toGMTString();
        }
        else {
            expires = "";
        }
        document.cookie = name + "=" + value + expires + "; path=/";
    }
    
    function getCookie(c_name) {
        if (document.cookie.length > 0) {
            c_start = document.cookie.indexOf(c_name + "=");
            if (c_start != -1) {
                c_start = c_start + c_name.length + 1;
                c_end = document.cookie.indexOf(";", c_start);
                if (c_end == -1) {
                    c_end = document.cookie.length;
                }
                return unescape(document.cookie.substring(c_start, c_end));
            }
        }
        return "";
    }
    window.onload = () => {
      if (getCookie('popupShown') != 'yes') {
        const myModal = new bootstrap.Modal('#exampleModal');
        myModal.show();
        createCookie('popupShown', 'yes', 1)
      }
    }
</script><script src="../site_libs/kePrint-0.0.1/kePrint.js"></script><link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../library/">Research design library</a></li><li class="breadcrumb-item"><a href="../library/complex.html"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Complex designs</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Research Design in the Social Sciences</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../authors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About the authors</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../acknowledgements.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Acknowledgements</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../introduction/preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Preface</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../introduction/what-is-a-research-design.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">What is a research design?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../introduction/research-design-principles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Research design principles</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../introduction/getting-started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Getting started</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Declaration, Diagnosis, Redesign</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../declaration-diagnosis-redesign/declaring-designs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Declaring designs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../declaration-diagnosis-redesign/specifying-model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Specifying the model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../declaration-diagnosis-redesign/defining-inquiry.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Defining the inquiry</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../declaration-diagnosis-redesign/crafting-research-strategy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Crafting a data strategy</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../declaration-diagnosis-redesign/choosing-answer-strategy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Choosing an answer strategy</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../declaration-diagnosis-redesign/redesigning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Redesigning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../declaration-diagnosis-redesign/diagnosing-designs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Diagnosing designs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../declaration-diagnosis-redesign/design-example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Design example</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../declaration-diagnosis-redesign/declaration-in-code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Designing in code</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../library/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Research design library</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../library/observational-descriptive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Observational : descriptive</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../library/observational-causal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Observational : causal</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../library/experimental-descriptive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Experimental : descriptive</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../library/experimental-causal.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Experimental : causal</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../library/complex.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Complex designs</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../lifecycle/" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Research design lifecycle</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lifecycle/planning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Planning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lifecycle/realization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Realization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lifecycle/integration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Integration</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../epilogue.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Epilogue</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../student-teacher.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Student and teacher resources</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../errata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Errata</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar"><div class="quarto-margin-header"><div class="margin-header-item">
<p align="center">
<a style="color: black; text-decoration: none; font-size: 17px" target="_new" href="https://press.princeton.edu/books/paperback/9780691199573/research-design-in-the-social-sciences"> <img style="border: 1px solid darkgray; margin-bottom: 5px" width="100px" src="../figures/cover.jpg"><br>Preorder book</a>
</p>
</div></div>
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
    <ul>
<li>
<a href="#discovery-using-causal-forests" id="toc-discovery-using-causal-forests" class="nav-link active" data-scroll-target="#discovery-using-causal-forests"><span class="header-section-number">19.1</span> Discovery using causal forests</a>
    <ul class="collapse">
<li><a href="#design-examples" id="toc-design-examples" class="nav-link" data-scroll-target="#design-examples"><span class="header-section-number">19.1.1</span> Design examples</a></li>
    </ul>
</li>
    <li>
<a href="#sec-ch19s2" id="toc-sec-ch19s2" class="nav-link" data-scroll-target="#sec-ch19s2"><span class="header-section-number">19.2</span> Structural estimation</a>
    <ul class="collapse">
<li><a href="#design-examples-1" id="toc-design-examples-1" class="nav-link" data-scroll-target="#design-examples-1"><span class="header-section-number">19.2.1</span> Design examples</a></li>
    </ul>
</li>
    <li>
<a href="#sec-ch19s3" id="toc-sec-ch19s3" class="nav-link" data-scroll-target="#sec-ch19s3"><span class="header-section-number">19.3</span> Meta-analysis</a>
    <ul class="collapse">
<li><a href="#design-examples-2" id="toc-design-examples-2" class="nav-link" data-scroll-target="#design-examples-2"><span class="header-section-number">19.3.1</span> Design examples</a></li>
    </ul>
</li>
    <li>
<a href="#multi-site-studies" id="toc-multi-site-studies" class="nav-link" data-scroll-target="#multi-site-studies"><span class="header-section-number">19.4</span> Multi-site studies</a>
    <ul class="collapse">
<li><a href="#design-examples-3" id="toc-design-examples-3" class="nav-link" data-scroll-target="#design-examples-3"><span class="header-section-number">19.4.1</span> Design examples</a></li>
    </ul>
</li>
    </ul>
<ul><li><a class="navlink nav-link" href="https://doi.org/10.7910/DVN/HYVPO5" data-scroll-target="https\://doi.org/10.7910/DVN/HYVPO5">Replication code and data</a></li></ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body" style="text-align: center">
        <img width="400px" src="https://book.declaredesign.org/figures/cover.jpg" style="margin-bottom: 15px"><br>
        Available for preorder from Princeton University Press
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <!--<button type="button" class="btn btn-primary">Buy book</button>-->
        <a href="https://www.amazon.com/Research-Design-Social-Sciences-Declaration/dp/0691199574/?&amp;_encoding=UTF8&amp;tag=declaredesign-20&amp;linkCode=ur2&amp;linkId=84be1f952d1d7aaaa5be867eade93474&amp;camp=1789&amp;creative=9325" target="_blank" class="btn btn-info" role="button">Amazon</a>
        <a href="https://press.princeton.edu/books/paperback/9780691199573/research-design-in-the-social-sciences" target="_blank" class="btn btn-info" role="button">Princeton University Press</a>
      </div>
    </div>
  </div>
</div>

<header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Complex designs</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><p>In the designs we presented thus far, the aim was generally to learn about the level of some variable or some particular causal effect. In most cases, a single set of data was collected and an answer strategy was applied directly to the data to generate an answer to a causal or descriptive inquiry.</p>
<p>Very few published studies have this actual form. Instead, most draw in complex ways on a series of research designs, each targeted to a different inquiry, that when brought together answer the deeper theoretical question at the heart of the research. Most published studies are complex in this way.</p>
<p>But studies can also be “complex” in other ways. For instance, although we have assumed researchers start with well defined inquiries, some studies focus on first figuring out what question to ask and then proceed to ask and answer it. The study engages first in model building, then reports the results of a follow-on research design targeted at questions posed by the new model.</p>
<p>Some studies seek not to learn about levels and effects but search explicitly for a model of a phenomenon, asking for instance “what causes <span class="math inline">\(Y\)</span>?” or “what model, in some class, best accounts for observed data”? These studies have complex inquiries. Other studies have complex data and answer strategies, for instance, mixing qualitative and quantitative inference strategies or gathering together findings from multiple sub-studies in order to arrive at an overall conclusion.</p>
<section id="discovery-using-causal-forests" class="level2" data-number="19.1"><h2 data-number="19.1" class="anchored" data-anchor-id="discovery-using-causal-forests">
<span class="header-section-number">19.1</span> Discovery using causal forests</h2>
<div class="ddbox">
<p>We declare a design in which a researcher examines a large set of continuous covariates to discover (i) which covariate best explains heterogeneity in the effects of a treatment and (ii) which subjects experiences the weakest or strongest effects. The design declaration clarifies the inquiries when the goal of the study is discovery and can be used to guide design decisions regarding how best to split data into training and testing sets.</p>
</div>
<p>In most designs that we have discussed, researchers have a clear idea what they are looking for when they begin the research. How big is some population? What is the size of some effect? But some research involves questions that are much more open in nature. We focus here on discovery research that has two types of more open questions. The first inquiry poses an open question of the form “what matters?” (rather than the more common closed question of the form “what is the effect of this on that?”). The second inquiry poses a question about an as-yet unspecified group — who are the people for whom effects are especially strong or weak?</p>
<p>We imagine a setting in which a researcher has access to a large group of covariates <span class="math inline">\(X\)</span> and has conducted an experiment to assess the effects of <span class="math inline">\(Z\)</span> on <span class="math inline">\(Y\)</span>. The researcher is interested in the <em>heterogeneity</em> of effects of <span class="math inline">\(Z\)</span> as a function of variables in <span class="math inline">\(X\)</span> and in poses two inquiries. First, which covariate in <span class="math inline">\(X\)</span> best “explains” variation in the effect of <span class="math inline">\(Z\)</span>? Second, what combination of values in <span class="math inline">\(X\)</span> characterize individuals for whom effects are particularly weak?</p>
<p><a href="#def-ch19num1">Declaration&nbsp;<span>19.1</span></a> proceeds as follows.</p>
<p>For the model, we imagine a possibly complex function linking <span class="math inline">\(Z\)</span> to <span class="math inline">\(Y\)</span> in which the effect of <span class="math inline">\(Z\)</span> depends nonlinearly on some but not all variables in <span class="math inline">\(X\)</span>. As always, this model can and should be altered to help understand whether diagnosis depends on the particular type of structure assumed.</p>
<p>We declare two inquiries beyond the standard average treatment effect. For the first inquiry we need to be specific about what we mean by “best explains.” We will imagine asking which covariate <span class="math inline">\(X\)</span> produces the lowest conditional variance <span class="math inline">\(\mathbb{E}(\mathbb{V}(Y_i(1)- Y_i(0)|X_i = x))\)</span>. Specifically, we partition each covariate into quantiles and take the average variance in treatment effect across each quantile. We will call this the <code>best_predictor</code> inquiry and calculate it using the <span class="math inline">\(R^2\)</span> from a fixed-effects model applied to the true treatment effects. The <code>best_predictor</code> function in <code>rdss</code> calculates this estimand, dividing covariates into 20 quantiles by default.</p>
<p>There is both a simple and a more complex understanding of the second inquiry. The simple understanding is that we are interested in the average effect among the units whose effects are in the bottom 20% (say) of all effects. We will call this the <code>worst_effects</code> inquiry. This is a natural notion of the worst affected. But it is a very difficult quantity to estimate.</p>
<p>The more complex understanding involves examining the realized data to do our best to identify a set of units (say of size 20%) that we think will have weak effects, and with this set identified return to <em>M</em> and ask what is the average effect for this set. We will call this the <code>weak_effects</code> inquiry, to acknowledge the fact that the effects for this group may not be the worst effects. This data-dependent inquiry is more complicated to articulate theoretically, but it is more straightforward to estimate empirically.</p>
<p>We assume the data strategy is the same as for a simple two arm trial (see <a href="experimental-causal.html#sec-ch18s1"><span>Section&nbsp;18.1</span></a>).</p>
<p>This causal forests design gets its name from the answer strategy. The “causal forests” algorithm randomly partitions data into a training and testing group. Within the training group it repeatedly generates “trees” by repartitioning the covariates (generating “branches”) to identify subgroups (“leafs”) with similar treatment effects. At each step, partitioning is implemented to yield estimated minimum variance in treatment effects. Unit level predictions of treatment effects (in both the training and the testing sets) are then generated by combining estimates of effects for units over different trees <span class="citation" data-cites="wager2018estimation">(see <a href="../references.html#ref-wager2018estimation" role="doc-biblioref">Wager and Athey 2018</a> for full details of the approach)</span>. Our estimate of the <code>best_predictor</code> is based on the variable that is most frequently partitioned to reduce variance, though we note that this indicator was not designed to capture the variable that induces the greatest reduction in variance. Including it here allows us to illustrate the ability of diagnosis to assess the performance of an estimator for a task for which it was not designed.</p>
<p>To implement causal forests in <code>DeclareDesign</code>, we wrote a “handler” that calls a function from the <code>grf</code> (generalized random forests) package. This handler produces two types of quantities: estimates of unit level causal effects and the name of the variable that is most frequently partitioned to reduce variance (<code>var_imp</code>). Because the output includes a prediction for each unit it is natural to add the output to the primary data frame. For that reason, the causal forests estimation is introduced as data strategy step and not specifically in an answer strategy step. The estimates of the unit level causal effects are used in order to identify the weakly performing group (within the test set and within the full set) which is in turn used to calculate the two versions of the <code>weak_effects</code> estimands, one for the test set and one for the full sample. To accommodate these complexities, the final inquiry declaration takes place after the implementation of the causal forests algorithm.</p>
<p>Finally, we use regression to estimate the ATE as well as the weak effects and worst effects estimands using both the identified low performing group in the test set data and the identified low performing group in the full data. We assess the performance of these against both the <code>weak_effects</code> inquiry and the <code>worst_effects</code> inquiry.</p>
<div id="def-ch19num1" class="declaration theorem definition">
<p><span class="theorem-title"><strong>Declaration 19.1 </strong></span>Random forests design</p>
<div class="cell" data-file="scripts_declarations/declaration_19.1.R">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">rdss</span><span class="op">)</span> <span class="co"># for helper functions</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/grf-labs/grf">grf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">covariate_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"X."</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">f_Y</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span>, <span class="va">X.1</span>, <span class="va">X.2</span>, <span class="va">X.3</span>, <span class="va">X.4</span>, <span class="va">u</span><span class="op">)</span> </span>
<span>  <span class="va">z</span> <span class="op">*</span> <span class="va">X.1</span> <span class="op">+</span> <span class="va">z</span> <span class="op">*</span> <span class="va">X.2</span> <span class="op">^</span> <span class="fl">2</span> <span class="op">+</span> <span class="va">z</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">X.3</span><span class="op">)</span> <span class="op">+</span> <span class="va">z</span> <span class="op">*</span> <span class="va">X.3</span> <span class="op">*</span> <span class="va">X.4</span> <span class="op">+</span> <span class="va">u</span></span>
<span></span>
<span><span class="va">get_best_predictor</span> <span class="op">&lt;-</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="fu">select</span><span class="op">(</span><span class="va">data</span>, estimate <span class="op">=</span> <span class="va">var_imp</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">declaration_19.1</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">declare_model</span><span class="op">(</span></span>
<span>    N <span class="op">=</span> <span class="fl">1000</span>,  </span>
<span>    X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">10</span> <span class="op">*</span> <span class="va">N</span><span class="op">)</span>, <span class="va">N</span><span class="op">)</span>,</span>
<span>    U <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span>,</span>
<span>    Z <span class="op">=</span> <span class="fu">simple_ra</span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">declare_model</span><span class="op">(</span></span>
<span>    Y_Z_1 <span class="op">=</span> <span class="fu">f_Y</span><span class="op">(</span><span class="fl">1</span>, <span class="va">X.1</span>, <span class="va">X.2</span>, <span class="va">X.3</span>, <span class="va">X.4</span>, <span class="va">U</span><span class="op">)</span>,</span>
<span>    Y_Z_0 <span class="op">=</span> <span class="fu">f_Y</span><span class="op">(</span><span class="fl">0</span>, <span class="va">X.1</span>, <span class="va">X.2</span>, <span class="va">X.3</span>, <span class="va">X.4</span>, <span class="va">U</span><span class="op">)</span>,</span>
<span>    tau <span class="op">=</span> <span class="va">Y_Z_1</span> <span class="op">-</span> <span class="va">Y_Z_0</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">declare_inquiry</span><span class="op">(</span>handler <span class="op">=</span> <span class="va">best_predictor</span>, </span>
<span>                  covariate_names <span class="op">=</span> <span class="va">covariate_names</span>,</span>
<span>                  label <span class="op">=</span> <span class="st">"best"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">declare_measurement</span><span class="op">(</span>Y <span class="op">=</span> <span class="fu">reveal_outcomes</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">declare_measurement</span><span class="op">(</span></span>
<span>    handler <span class="op">=</span> <span class="va">causal_forest_handler</span>, </span>
<span>    covariate_names <span class="op">=</span> <span class="va">covariate_names</span>,</span>
<span>    share_train <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">declare_measurement</span><span class="op">(</span></span>
<span>    handler <span class="op">=</span> <span class="va">fabricate</span>, </span>
<span>    low_test  <span class="op">=</span> <span class="op">(</span><span class="va">test</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">pred</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">pred</span><span class="op">[</span><span class="va">test</span><span class="op">]</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    low_all <span class="op">=</span> <span class="va">pred</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">pred</span>, <span class="fl">0.2</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">declare_inquiry</span><span class="op">(</span></span>
<span>    ate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tau</span><span class="op">)</span>,</span>
<span>    worst_effects_all <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tau</span><span class="op">[</span><span class="va">tau</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">tau</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    worst_effects_test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tau</span><span class="op">[</span><span class="va">test</span> <span class="op">&amp;</span> <span class="va">tau</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">tau</span><span class="op">[</span><span class="va">test</span><span class="op">]</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    weak_effects_all <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tau</span><span class="op">[</span><span class="va">low_all</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    weak_effects_test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">tau</span><span class="op">[</span><span class="va">low_test</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">declare_estimator</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span>, inquiry <span class="op">=</span> <span class="st">"ate"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">declare_estimator</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span>, subset <span class="op">=</span> <span class="va">low_test</span>, </span>
<span>                    inquiry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"weak_effects_test"</span>, <span class="st">"worst_effects_test"</span><span class="op">)</span>, </span>
<span>                    label <span class="op">=</span> <span class="st">"lm_weak_test"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">declare_estimator</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">Z</span>, subset <span class="op">=</span> <span class="va">low_all</span>, </span>
<span>                    inquiry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"weak_effects_all"</span>, <span class="st">"worst_effects_all"</span><span class="op">)</span>, </span>
<span>                    label <span class="op">=</span> <span class="st">"lm_weak_all"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">declare_estimator</span><span class="op">(</span>handler <span class="op">=</span> <span class="fu">label_estimator</span><span class="op">(</span><span class="va">get_best_predictor</span><span class="op">)</span>,</span>
<span>                    inquiry <span class="op">=</span> <span class="st">"best_predictor"</span>, label <span class="op">=</span> <span class="st">"cf"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<p>Before turning to diagnosis we can get a feel for the performance of the causal forest estimator by comparing the predicted effects for each unit generated by the estimator, with the actual unit level treatment effects generated by <em>M</em>, as shown in <a href="#fig-ch19num1">Figure&nbsp;<span>19.1</span></a>.</p>
<div id="fig-ch19num1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="../figures/figure-19-1.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;19.1: One draw from the causal forests design</figcaption></figure>
</div>
<p>We see that we get some traction — but we also get a lot wrong. Estimating unit level causal effects is hard. We see in particular that that the <em>range</em> of the predictions is narrower than the range of the true effects, which will mean that the average effects in the groups with the best or worst predicted effects will generally not be the same as the effects for the groups with the best and worst actual effects.</p>
<p>To see how the design is choosing the best predictor, we illustrate the adjusted r-squared for a regression predicting the treatment effect with a partitioning of each variable, as well as the rank of predictors given the r-squared number in <a href="#fig-ch19num2">Figure&nbsp;<span>19.2</span></a>. We see that the third covariate <code>X.3</code> has a very high adjusted r-squared, and is ranked first, and most of the covariates are bunched at a very low r-squared.</p>
<div id="fig-ch19num2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="../figures/figure-19-2.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;19.2: How the best predictor estimates are constructed, from ranking variables in terms of their prediction power of the individual treatment effects as measured by the r-squared in a regression.</figcaption></figure>
</div>
<div id="lem-ch19num1" class="theorem lemma">
<p><span class="theorem-title"><strong>Diagnosis 19.1 </strong></span>Causal forests diagnosis</p>
<p>For the diagnosis we need to take account of the fact that the answers to one of the inquiries (“Which X accounts for the most variation in effects?”) should be treated as categorical. For this reason, we report the modal estimate and estimand, rather than relying on the average estimate and average estimand. We calculate the probability that we get the correct answer, rather than relying on bias. We illustrate the diagnosis in <a href="#fig-ch19num3">Figure&nbsp;<span>19.3</span></a>.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">most_common</span> <span class="op">&lt;-</span> </span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ux</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>    <span class="va">ux</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tabulate.html">tabulate</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">ux</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="va">discovery_diagnosands</span>  <span class="op">&lt;-</span> </span>
<span>  <span class="fu">declare_diagnosands</span><span class="op">(</span></span>
<span>    correct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">estimate</span> <span class="op">==</span> <span class="va">estimand</span><span class="op">)</span>,</span>
<span>    bias <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">estimate</span> <span class="op">-</span> <span class="va">estimand</span><span class="op">)</span>,</span>
<span>    rmse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="op">(</span><span class="va">estimate</span> <span class="op">-</span> <span class="va">estimand</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    mean_estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span>,</span>
<span>    modal_estimate <span class="op">=</span> <span class="fu">most_common</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">estimate</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    mean_estimand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">estimand</span><span class="op">)</span>,</span>
<span>    modal_estimand <span class="op">=</span> <span class="fu">most_common</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">estimand</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">diagnosis_19.1</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">diagnose_design</span><span class="op">(</span><span class="va">declaration_19.1</span>, </span>
<span>                  diagnosands <span class="op">=</span> <span class="va">discovery_diagnosands</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-ch19num3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="../figures/figure-19-3.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;19.3: Sampling distributions of estimates of five estimands from the causal forest design.</figcaption></figure>
</div>
<p>We see that we do very well in identifying the most powerful predictor of heterogeneity, correct nearly all of the time. (We are never “correct” for the continuous estimands, but we would never expect to be.) Our estimator for the effects for the weak group within the testing set is unbiased. This follows from the fact that we are in essence estimating the causal effect within a subgroup that has been selected without knowledge of their potential outcomes. Substantively the effects for this group are indeed considerably lower than the average treatment effects and so we have been successful in identifying units that experience weak effects on average and estimating the effects for these. Thus we have been successful for a version of both inquiries.</p>
<p>The other diagnoses sharpen our understanding of what questions cannot be so easily answered with this design. First we see that estimates of the effects for the weak performers do not do a good job of estimating effects for the <em>worst</em> performers. This highlights that the procedure can generate unbiased estimates for <em>a</em> group that does poorly but not <em>the</em> group that does most poorly. We can further see from the diagnosis that while we recover effects for the test group well, we have some bias when trying to estimate the effects for the weak performing set in the combined training and test data data. The reason for bias here is that training group units enter the worse performing set in part because of their realized outcomes (which helped define the set) and not just on the basis of pre-treatment features. The bias is small however—so small it is barely discernible in the histograms—and so the restriction of analysis to the training set only ultimately increases mean squared error here.</p>
<p>Overall the approach fares well and through diagnosis we get clarity over which quantities are well estimated. Modifications of this design can help us assess how sensitive performance is to types of stipulated models and choices about train-test splits.</p>
</div>
<section id="design-examples" class="level3" data-number="19.1.1"><h3 data-number="19.1.1" class="anchored" data-anchor-id="design-examples">
<span class="header-section-number">19.1.1</span> Design examples</h3>
<ul>
<li><p><span class="citation" data-cites="Bauer2021">Bauer and Hohenberg (<a href="../references.html#ref-Bauer2021" role="doc-biblioref">2021</a>)</span> uses a causal forests algorithm to explore the heterogeneous effects of a manipulation of the source (real or fake) of a political news. The average effect of a real (versus fake) source on belief in the facts reported in the article is positive, and it is more positive for those with greater trust in media and more political knowledge.</p></li>
<li><p><span class="citation" data-cites="green2022using">Green et al. (<a href="../references.html#ref-green2022using" role="doc-biblioref">2022</a>)</span> study the effects of messages designed to increase vaccine intentions with a survey experiment. They apply a causal forests algorithm to uncover the possibly heterogeneous effects of the treatment depending on observed covariates like income, local disease burden, and political ideology, but find that responses to treatment are mostly homogeneous.</p></li>
</ul></section></section><section id="sec-ch19s2" class="level2" data-number="19.2"><h2 data-number="19.2" class="anchored" data-anchor-id="sec-ch19s2">
<span class="header-section-number">19.2</span> Structural estimation</h2>
<div class="ddbox">
<p>We declare a design in which a researcher wants to use experimental data to estimate the parameters of a game theoretic model. The premise of the approach is that, to the extent that the model is correct, in-sample parameter estimation allows the researcher to make interesting external inferences to effects in other settings. The risk is that bad models will produce bad inferences.</p>
</div>
<p>Structural estimation is used when researchers have in mind a model for how processes work and their goal is to estimate the parameters of that model. If only they knew the parameters of the model, they could draw inferences about levels of unobserved variables, treatment effects, or other quantities. They might even extrapolate to estimate counterfactual quantities, such as the effects of interventions that have not been implemented <span class="citation" data-cites="reiss2007structural">(<a href="../references.html#ref-reiss2007structural" role="doc-biblioref">Reiss and Wolak 2007</a>)</span>.</p>
<p>We illustrate this design with a bargaining game, drawing on an example used in <span class="citation" data-cites="wilke2020field">Wilke and Humphreys (<a href="../references.html#ref-wilke2020field" role="doc-biblioref">2020</a>)</span>. We imagine a customer <span class="math inline">\(i\)</span> makes payments from some endowment to a taxi driver. Bargaining proceeds as one player makes an offer that is accepted or rejected; if rejected the other player makes a counteroffer. The game continues for <span class="math inline">\(n\)</span> rounds with zero payoffs if no deal is agreed. Our main interest is the share of the endowment retained by the customer.</p>
<p>In <a href="#def-ch19num2">Declaration&nbsp;<span>19.2</span></a>, we imagine two types of customers, strategic (<span class="math inline">\(\theta_i = 0\)</span>) and nonstrategic (<span class="math inline">\(\theta_i = 1\)</span>). If a customer is strategic, the equilibrium offer made by the first mover is the one predicted by the solution given in <span class="citation" data-cites="rubinstein1982perfect">Rubinstein (<a href="../references.html#ref-rubinstein1982perfect" role="doc-biblioref">1982</a>)</span>. If however, the player is nonstrategic then they always (successfully) insist on invoking a payment norm that lets them retaining a fixed share of their endowment, <span class="math inline">\(\tilde{\pi}\)</span>. We let <span class="math inline">\(\alpha\)</span> denote the probability that a player is nonstrategic. A player’s payoff then is given by:</p>
<p><span class="math display">\[\pi_i =  (1-\theta_i)(z_i\hat{\pi} + (1-z_i)(1-\pi)) + \theta_i\tilde{\pi}\]</span></p>
<p>where <span class="math display">\[\hat{\pi} = \sum_{j = 2}^n(-1^{j})\delta^{j-1}\]</span></p>
<p>is the Rubinstein solution. The customer’s payoff depends on whether they goes first (<span class="math inline">\(z_i = 1\)</span>) or second (<span class="math inline">\(z_i = 0\)</span>) and on the common discount factor <span class="math inline">\(\delta\)</span>.</p>
<p>One complication with structural estimation is that it’s hard to know what to infer when an action is taken that the model says shouldn’t happen – suppose negotiations didn’t reach <span class="math inline">\(\tilde{\pi}\)</span> when they should have. A common way to address this challenge is to allow for the possibility that <em>implemented</em> actions are noisy reflections of <em>predicted</em> actions; noisy either because of measurement error or because in fact players deviate randomly from optimal behavior. Here we will allow for a disturbance like this by assuming that <em>measured</em> payments, <span class="math inline">\(y\)</span>, are a random draw from a Beta distribution with expectation given by the expected payment <span class="math inline">\(\pi\)</span> and variance <span class="math inline">\(\kappa\)</span>.</p>
<p>In our data strategy, we randomly assign <span class="math inline">\(Z\)</span> (who goes first) and measure payments <span class="math inline">\(y\)</span>. We will also assume we know what norms nonstrategic players are following, specifically that <span class="math inline">\(\tilde{\pi} = 0.75\)</span>. Our goal is to use observed payments along with treatment allocation to estimate the model parameters, <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\delta\)</span>, <span class="math inline">\(\kappa\)</span>. These in turn can be used to estimate treatment effects and other counterfactual quantities (if we assume the model is true).</p>
<p>Our inquiries are the parameters <code>k</code>, <code>d</code>, and <code>a</code> (corresponding to <span class="math inline">\(\kappa\)</span>, <span class="math inline">\(\delta\)</span> and <span class="math inline">\(\alpha\)</span>). We set up the design so that we can vary these features easily but also so that we can vary <span class="math inline">\(n\)</span> (the total number of rounds in the bargaining game).</p>
<p>The answer strategy is implemented using maximum likelihood to identify which parameter values are most consistent with the data. More specifically this approach takes the model as true and asks for what collection of parameter values is the observed data most likely. See <span class="citation" data-cites="king1998unifying">King (<a href="../references.html#ref-king1998unifying" role="doc-biblioref">1998</a>)</span> for an introduction to the method of maximum likelihood. One nice feature of the method is that the problem of maximizing the likelihood is (asymptotically) equivalent to finding the probability distribution that minimizes the Kullback–Leibler divergence to the true probability distribution (of course, all that within the class of distributions that can be specified under the model). For more see <span class="citation" data-cites="white1982maximum">White (<a href="../references.html#ref-white1982maximum" role="doc-biblioref">1982</a>)</span>.</p>
<p>The heart of the estimation strategy is the specification of likelihood function. The likelihood function reports the probability of the data given particular stipulated values of the parameters. This value is different depending on <span class="math inline">\(n\)</span> so in fact we write down a function that writes a function given <span class="math inline">\(n\)</span>. The likelihood function reflects the theoretical model described above, which means that in this declaration, the same event generating process is used in <em>M</em> and in the construction of the likelihood function in <em>A</em>. An optimistic assumption.</p>
<div id="def-ch19num2" class="declaration theorem definition">
<p><span class="theorem-title"><strong>Declaration 19.2 </strong></span>Structural estimation declaration</p>
<p>With the likelihood function defined, we can declare a design with an estimation step that uses the <code>bbmle</code> package</p>
<div class="cell" data-file="scripts_declarations/declaration_19.2.R">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bbolker/bbmle">bbmle</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Equilibrium offers for a game of length n</span></span>
<span><span class="va">offer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">d</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="va">n</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">(</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">^</span><span class="va">t</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">d</span><span class="op">^</span><span class="op">{</span><span class="va">t</span><span class="op">-</span><span class="fl">1</span><span class="op">}</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Likelihood function</span></span>
<span><span class="va">likelihood</span>  <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">k</span>, <span class="va">d</span>, <span class="va">a</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">m</span> <span class="op">&lt;-</span> <span class="va">Z</span> <span class="op">*</span> <span class="fu">offer</span><span class="op">(</span><span class="va">n</span>, <span class="va">d</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">Z</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu">offer</span><span class="op">(</span><span class="va">n</span>, <span class="va">d</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">R</span> <span class="op">&lt;-</span> <span class="va">a</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">dbeta</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">k</span> <span class="op">*</span> <span class="fl">.75</span>, <span class="va">k</span> <span class="op">*</span> <span class="fl">.25</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">a</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">dbeta</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">k</span> <span class="op">*</span> <span class="va">m</span>, <span class="va">k</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">m</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">R</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">2</span>        <span class="co"># Number of rounds bargaining (design choice)</span></span>
<span><span class="va">delta</span> <span class="op">&lt;-</span> <span class="fl">0.8</span>  <span class="co"># True discount factor (unknown)</span></span>
<span><span class="va">kappa</span> <span class="op">&lt;-</span> <span class="fl">2</span>    <span class="co"># Parameter to govern error in offers (unknown)</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>  <span class="co"># Share of behavioral types in the population (unknown)</span></span>
<span></span>
<span><span class="va">declaration_19.2</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">declare_model</span><span class="op">(</span></span>
<span>    <span class="co"># Define the population: indicator for behavioral type (norm = 1)</span></span>
<span>    N <span class="op">=</span> <span class="fl">200</span>, </span>
<span>    type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, <span class="va">alpha</span><span class="op">)</span>,</span>
<span>    n <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">declare_inquiry</span><span class="op">(</span>kappa <span class="op">=</span> <span class="va">kappa</span>,     </span>
<span>                  delta <span class="op">=</span> <span class="va">delta</span>,     </span>
<span>                  alpha <span class="op">=</span> <span class="va">alpha</span><span class="op">)</span> <span class="op">+</span>   </span>
<span>  <span class="fu">declare_assignment</span><span class="op">(</span>Z <span class="op">=</span> <span class="fu">complete_ra</span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">declare_measurement</span><span class="op">(</span></span>
<span>    <span class="co"># Equilibrium payoff</span></span>
<span>    pi <span class="op">=</span> <span class="va">type</span> <span class="op">*</span> <span class="fl">.75</span> <span class="op">+</span> </span>
<span>      <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">type</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">Z</span> <span class="op">*</span> <span class="fu">offer</span><span class="op">(</span><span class="va">n</span>, <span class="va">delta</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">Z</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span><span class="fu">offer</span><span class="op">(</span><span class="va">n</span>, <span class="va">delta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    <span class="co"># Actual payoff (stochastic)</span></span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">pi</span> <span class="op">*</span> <span class="va">kappa</span>, <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">pi</span><span class="op">)</span> <span class="op">*</span> <span class="va">kappa</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="co"># Estimation via maximum likelihood</span></span>
<span>  <span class="fu">declare_estimator</span><span class="op">(</span>.method <span class="op">=</span> <span class="va">mle2</span>,</span>
<span>                    minuslogl <span class="op">=</span> <span class="fu">likelihood</span><span class="op">(</span><span class="va">n</span><span class="op">)</span>,</span>
<span>                    start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">2</span>, d <span class="op">=</span> <span class="fl">0.50</span>, a <span class="op">=</span> <span class="fl">0.50</span><span class="op">)</span>,</span>
<span>                    lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">0.10</span>, d <span class="op">=</span> <span class="fl">0.01</span>, a <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>                    upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>k <span class="op">=</span> <span class="fl">100</span>, d <span class="op">=</span> <span class="fl">0.99</span>, a <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span>,</span>
<span>                    method <span class="op">=</span> <span class="st">"L-BFGS-B"</span>,</span>
<span>                    term <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"k"</span>, <span class="st">"d"</span>, <span class="st">"a"</span><span class="op">)</span>,</span>
<span>                    inquiry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"kappa"</span>,<span class="st">"delta"</span>, <span class="st">"alpha"</span><span class="op">)</span>, </span>
<span>                    label <span class="op">=</span> <span class="st">"Structural model"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="lem-ch19num2" class="theorem lemma">
<p><span class="theorem-title"><strong>Diagnosis 19.2 </strong></span>Structural estimation diagnosis</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">diagnosis_19.2</span> <span class="op">&lt;-</span> <span class="fu">diagnose_design</span><span class="op">(</span><span class="va">declaration_19.2</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-structuraldiagnosisa" class="anchored">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table&nbsp;19.1: Estimation of structural parameters from behavior in a bargaining game</caption>
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Inquiry</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Mean Estimand</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Bias</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">RMSE</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">alpha</td>
<td style="text-align: left;">0.50</td>
<td style="text-align: left;">-0.00</td>
<td style="text-align: left;">0.08</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">(0.00)</td>
<td style="text-align: left;">(0.01)</td>
<td style="text-align: left;">(0.01)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">delta</td>
<td style="text-align: left;">0.80</td>
<td style="text-align: left;">0.00</td>
<td style="text-align: left;">0.03</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">(0.00)</td>
<td style="text-align: left;">(0.00)</td>
<td style="text-align: left;">(0.00)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">kappa</td>
<td style="text-align: left;">2.00</td>
<td style="text-align: left;">0.07</td>
<td style="text-align: left;">0.26</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">(0.00)</td>
<td style="text-align: left;">(0.03)</td>
<td style="text-align: left;">(0.02)</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>Turning to diagnosis we see first that we do a good job in recovering parameter values. All three parameters are estimated precisely. From these, we can calculate estimates of causal quantities such as the first mover advantage and assess the extent to which this depends on features such as the length of the game.</p>
<p>As always, diagnosis can be used to fine-tune designs. In <a href="#fig-ch19num4">Figure&nbsp;<span>19.4</span></a>, we compare design performance as we vary <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(n\)</span>. We see from the comparison of designs that estimates are less accurate when either longer games are used or when there are many nonstrategic players. Shorter games have an advantage here of producing a more pronounced difference in the payoffs of first and second movers. The gains from shorter games are especially pronounced in settings in which many nonstrategic players dampen the variation in payoffs. Though not shown here, it we can also use design diagnosis to show that the design fails if we set <span class="math inline">\(n\)</span> at 3 (for instance) as in this case <span class="math inline">\(\delta\)</span> is not identified (the same probability distribution is consistent with different values for <span class="math inline">\(\delta\)</span>).</p>
<div id="fig-ch19num4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="../figures/figure-19-4.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;19.4: Performance of the structural estimation design depends on the number of rounds and the types of players.</figcaption></figure>
</div>
<p>The basic structure used here can be used for a wide range of structural models. The first step is to write down the theory well enough to specify the implied likelihood function. Doing so might require adding noise to the model so that the data that are seen in practice can be seen in theory. The next step is to estimate the model parameters that have the greatest likelihood of having producing the observed data. (The same fundamental approach can be used with estimation via Bayesian methods or methods of moments.)</p>
<p>The payoffs from structural estimation can be great: we can operationalize our theoretical models to make specific real-world predictions by disciplining them with real-world information. The risks are large too. Because the inferences are necessarily model dependent, model misspecification can lead to faulty conclusions. When doing structural estimation, apply <a href="../introduction/research-design-principles.html#exm-designagnostically">Principle&nbsp;<span>3.2</span></a>: Design agnostically liberally.</p>
</div>
<section id="design-examples-1" class="level3" data-number="19.2.1"><h3 data-number="19.2.1" class="anchored" data-anchor-id="design-examples-1">
<span class="header-section-number">19.2.1</span> Design examples</h3>
<ul>
<li><p><span class="citation" data-cites="Samii2016">Samii (<a href="../references.html#ref-Samii2016" role="doc-biblioref">2016</a>)</span> enumerates some examples of structural estimation in economics and predicts future political scientists will take to structural estimation in earnest.</p></li>
<li><p><span class="citation" data-cites="francois2015power">Francois, Rainer, and Trebbi (<a href="../references.html#ref-francois2015power" role="doc-biblioref">2015</a>)</span> provides a structural model to explain how leaders allocate cabinet positions to bolseter coalitions; the analysis compares the performance of a preferred theory to rival theories.</p></li>
<li><p><span class="citation" data-cites="Frey2022">Frey, López-Moctezuma, and Montero (<a href="../references.html#ref-Frey2022" role="doc-biblioref">2022</a>)</span> estimates a structural model of party competition and coalitions on the basis of a regression discontinuity design. With the model parameters estimated, the authors simulate counterfactual scenarios without party coalitions.</p></li>
</ul></section></section><section id="sec-ch19s3" class="level2" data-number="19.3"><h2 data-number="19.3" class="anchored" data-anchor-id="sec-ch19s3">
<span class="header-section-number">19.3</span> Meta-analysis</h2>
<div class="ddbox">
<p>We declare a design for meta-analytic study in which a researcher seeks to combine findings from a collection of existing studies to form an overall conclusion. Declaration helps clarify the estimand in such studies. Diagnosis highlights risks associated with a common estimator used in meta-analysis, the fixed effect estimator.</p>
</div>
<p>In a meta-analysis, inquiries are typically population-level quantities like the population average treatment effect (PATE). The relevant population might be the full set of units that happened to participate in past research studies or it might be a broader population, like all human adults since 1950. The data strategy for a meta-analysis involves collecting all (or a subset) of the estimates generated by past research studies on the topic and standardizing them so they can be meaningfully compared or combined. Meta-analyses are valuable because they can tell us about the empirical consensus on a particular inquiry. Because they typically aggregate a large amount of information, meta-analyses are usually more precise than individual studies. We can also learn what we <em>don’t</em> know from a meta-analysis. After aggregating all the available evidence on a given inquiry, we may find that we don’t know very much at all.</p>
<p>The PATE inquiry, however, might not be so interesting if the constituent inquiries – the site-level ATEs – vary greatly from context to context. The ATEs that make up the PATE might vary because of the contextual features that condition the effect. <span class="citation" data-cites="galos_coppock_2022">Galos and Coppock (<a href="../references.html#ref-galos_coppock_2022" role="doc-biblioref">2022</a>)</span>, for example, reanalyze audit studies of gender-based employment discrimination to find that the ATE on callbacks of being a woman is strongly positive in women-dominated sectors and is strongly negative in men dominated sections. For this reason, meta-analyses often include inquiries about the variance of effects across studies or the covariance of effects with groups.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>The largest choice in the data strategy for a meta-analysis is the set of study inclusion and exclusion criteria. These criteria should be guided by the inquiries of the meta-analysis and whether the designs of the constituent studies appropriately inform the meta-analytic inquiry. If the inquiry is the population mean and standard deviation of the site level ATEs of treatment <span class="math inline">\(Z\)</span> on outcome <span class="math inline">\(Y\)</span>, we want to include only studies that credibly estimate the effect of <span class="math inline">\(Z\)</span> on <span class="math inline">\(Y\)</span>. This requirement means checking that all included studies use similar-enough treatments and similar-enough measurements of the outcome. It also means excluding studies that are prone to bias. For example, <span class="citation" data-cites="Pettigrew:2006th">Pettigrew and Tropp (<a href="../references.html#ref-Pettigrew:2006th" role="doc-biblioref">2006</a>)</span> assemble 515 studies of the contact hypothesis, but <span class="citation" data-cites="paluck_green_green_2019">Paluck, Green, and Green (<a href="../references.html#ref-paluck_green_green_2019" role="doc-biblioref">2019</a>)</span> exclude all but 5% of these studies in their updated meta-analysis for failing to randomize intergroup contact. Meta-analyses that include biased studies can compound biases, giving us falsely precise and incorrect answers. Finally, inclusion decisions should be made on the basis of the designs of the constituent studies and <em>not</em> their results. For example, we should not exclude studies that fail to reach statistical significance or yield unexpected answers.</p>
<p>The answer strategies for meta-analysis often amount to a weighted average of the individual study estimates. We take a weighted average instead of a simple average because we want to give different studies different amounts of pull in the overall estimate. In particular, we want to give studies that are more precise more weight and studies that are less precise less weight. In fixed-effects estimation, for example, study weights are proportional to the inverse of the estimated variance from the study. In random-effects estimation, by contrast, the weights are proportional to the inverse of the estimated variance from the study, plus an estimate of the between-study variance in effects. With this adjustment, the study weights are less extreme in random effects relative to fixed effects <span class="citation" data-cites="borenstein2021introduction">(for more see <a href="../references.html#ref-borenstein2021introduction" role="doc-biblioref">Borenstein et al. 2021</a>, ch.&nbsp;13)</span>. Fixed-effects meta-analysis may be appropriate in settings in which we have a strong theoretical reason to think the site-level inquiries are all equal to the PATE, but typically, we think effects vary from site-to-site, so random effects is usually the meta-analytic answer strategy of choice.</p>
<p>In <a href="#def-ch19num3">Declaration&nbsp;<span>19.3</span></a>, we declare a meta-analytic research design for 100 studies with a true PATE (<span class="math inline">\(\mu\)</span>) of 0.2. We represent the standard deviation of the study-level ATEs with <span class="math inline">\(\tau\)</span>, which we vary between 0 and 1. When <span class="math inline">\(\tau&gt;0\)</span> the true effects vary across contexts. The studies each have different measurement precision, with standard errors between 0.025 and 0.6. The inquiries are <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\tau^2\)</span>. In the answer strategy, we use both fixed and random effects meta-analysis.</p>
<div id="def-ch19num3" class="declaration theorem definition">
<p><span class="theorem-title"><strong>Declaration 19.3 </strong></span>Meta-analysis design</p>
<div class="cell" data-file="scripts_declarations/declaration_19.3.R">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.metafor-project.org">metafor</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fl">0.2</span> <span class="co"># true PATE</span></span>
<span><span class="va">tau</span> <span class="op">&lt;-</span> <span class="fl">0.0</span> <span class="co"># true SD of site-level ATEs</span></span>
<span></span>
<span><span class="va">design</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">declare_model</span><span class="op">(</span></span>
<span>    N <span class="op">=</span> <span class="fl">200</span>,</span>
<span>    site <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span>,</span>
<span>    std.error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span>, mean <span class="op">=</span> <span class="fl">0.8</span>, sd <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span>, mean <span class="op">=</span> <span class="va">mu</span>, sd <span class="op">=</span> <span class="va">tau</span><span class="op">)</span>, <span class="co"># when tau = 0, theta = mu </span></span>
<span>    estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span>, mean <span class="op">=</span> <span class="va">theta</span>, sd <span class="op">=</span> <span class="va">std.error</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">declare_inquiry</span><span class="op">(</span>mu <span class="op">=</span> <span class="va">mu</span>, tau_sq <span class="op">=</span> <span class="va">tau</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">declare_estimator</span><span class="op">(</span></span>
<span>    yi <span class="op">=</span> <span class="va">estimate</span>, sei <span class="op">=</span> <span class="va">std.error</span>, method <span class="op">=</span> <span class="st">"REML"</span>,</span>
<span>    .method <span class="op">=</span> <span class="va">rma_helper</span>, .summary <span class="op">=</span> <span class="va">rma_mu_tau</span>,</span>
<span>    term <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mu"</span>, <span class="st">"tau_sq"</span><span class="op">)</span>, inquiry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mu"</span>, <span class="st">"tau_sq"</span><span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="st">"random-effects"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">declare_estimator</span><span class="op">(</span></span>
<span>    yi <span class="op">=</span> <span class="va">estimate</span>, sei <span class="op">=</span> <span class="va">std.error</span>, method <span class="op">=</span> <span class="st">"FE"</span>,</span>
<span>    .method <span class="op">=</span> <span class="va">rma_helper</span>, .summary <span class="op">=</span> <span class="va">rma_mu_tau</span>,</span>
<span>    term <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mu"</span>, <span class="st">"tau_sq"</span><span class="op">)</span>, inquiry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mu"</span>, <span class="st">"tau_sq"</span><span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="st">"fixed-effects"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">declaration_19.3</span> <span class="op">&lt;-</span> <span class="fu">redesign</span><span class="op">(</span><span class="va">design</span>, tau <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="lem-ch19num3" class="theorem lemma">
<p><span class="theorem-title"><strong>Diagnosis 19.3 </strong></span>Meta-analysis diagnosis</p>
<p><a href="#fig-ch19num5">Figure&nbsp;<span>19.5</span></a> explores the bias and coverage of the two estimators under each model both for the mean effects inquiry <span class="math inline">\(\mu\)</span> and for the variance of effects inquiry <span class="math inline">\(\tau^2\)</span>. We find that the random effects estimator, across both models of how effects are realized, performs best. Whether the variance of site-level ATEs is 1 or 0, random effects estimates both inquiries without bias and coverage is nominal. By contrast, the fixed effect estimator has two problems. When <span class="math inline">\(\tau^2\)</span> is 1, the estimator gets the variance in estimates wrong, because it <em>assumes</em> it is zero. Second, the estimator is extremely overconfident, generating confidence intervals that are drastically too small, as reflected in the poor coverage. This overconfidence stems from the fixed-effect assumption that the only reason study-to-study estimates differ is due to estimation noise, not true differences across sites.</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">diagnosis_19.3</span> <span class="op">&lt;-</span> <span class="fu">diagnose_design</span><span class="op">(</span><span class="va">declaration_19.3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-ch19num5" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="../figures/figure-19-5.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;19.5: Coverage and bias of the fixed and random effects under two settings, effect homogeneity and effect heterogeneity.</figcaption></figure>
</div>
</div>
<section id="design-examples-2" class="level3" data-number="19.3.1"><h3 data-number="19.3.1" class="anchored" data-anchor-id="design-examples-2">
<span class="header-section-number">19.3.1</span> Design examples</h3>
<ul>
<li><p><span class="citation" data-cites="blair_christensen_rudkin_2021">Blair, Christensen, and Rudkin (<a href="../references.html#ref-blair_christensen_rudkin_2021" role="doc-biblioref">2021</a>)</span> meta-analyze 46 difference-in-difference studies of the effects of commodity price shocks on conflict, excluding over 300 studies of the same effect that relied on weaker identification strategies.</p></li>
<li><p><span class="citation" data-cites="schwarz_coppock_2020">Schwarz and Coppock (<a href="../references.html#ref-schwarz_coppock_2020" role="doc-biblioref">2022</a>)</span> collect 67 candidate choice conjoint experiments that randomized candidate gender to estimate the average effect of gender on electoral support.</p></li>
</ul></section></section><section id="multi-site-studies" class="level2" data-number="19.4"><h2 data-number="19.4" class="anchored" data-anchor-id="multi-site-studies">
<span class="header-section-number">19.4</span> Multi-site studies</h2>
<div class="ddbox">
<p>We declare a design for a coordinated research project in which multiple research teams combine data gathering and analysis strategies to address a common inquiry. Diagnosis clarifies the benefits and risks of coordination versus tailoring of treatments to contexts.</p>
</div>
<p>Nearly all social science is produced atomistically: individual scientists identify a question and a research strategy for answering it, apply the research strategy, and try to publish the results of that one study. Increasingly, scholars have come to realize that, though the standard research process may promote discovery, it is not optimized for the accumulation of general insights. One reason is that scientists are opportunistic in the contexts and units they study. If inquiry values are idiosyncratic to the contexts and units that scientists choose to study, then our studies will not generalize.</p>
<p>Scholars have addressed themselves to the problem of generalizability in a variety of ways. One approach is the replication of past studies in new contexts or with new populations. A second has been the application of statistical methods for extrapolating from single studies, relying on variation within studies in unit characteristics and effect heterogeneity. Both of these approaches are important.</p>
<p>We explore a third approach here: coordinated multi-site studies. The idea here is to implement the same research design (or as close as possible) across multiple contexts at the same time, each targeting the same inquiry with similar methods with the explicit intention of meta-analyzing the eventual results. In the previous chapter, we described <em>retrospective</em> meta-analysis in which a meta-analyst gathers together previous scholarship on a research question; harmonization of the studies is achieved <em>ex post</em> by including the studies that target the same theoretical quantity well and excluding those that do not. A coordinated multi-site study is a <em>prospective</em> meta-analysis; harmonization is achieved <em>ex ante</em> through the sometimes painstaking process of ensuring comparability of treatments, outcomes, and units across contexts.</p>
<p>How much we can learn about the generalizability of effects depends on how many sites we study, how we <em>select</em> the sites, our beliefs about effect heterogeneity, and the level of harmonization across studies. Of these, the harmonization level is most important. Without harmonization of research designs across sites, researchers risk answering different questions in different sites. If the goal is to understand a common inquiry and how values of the inquiry vary across contexts, then each site must be providing answers to (close to) the same inquiry. To do so, researchers coordinate measurement strategies so as to collect the same outcome measures and coordinate the details of treatment procedures to ensure they are studying the effects of the same intervention. They may also wish to coordinate on details like sampling to ensure the same types of subjects are enrolled at each site and on the consent and enrollment procedures so as to avoid introducing selection or demand effects differentially across sites.</p>
<p>The disadvantage of harmonization is that researchers end up answering a <em>different</em> question than they started out with. In the worst case, they end up answering one common question across all sites that is interesting in none. We explore these tradeoffs by declaring a modified multi-site design in which different treatments have different effects in different sites.</p>
<p><a href="#def-ch19num4">Declaration&nbsp;<span>19.4</span></a> describes a multi-site study with five sites. A conceptual challenge with multi-site studies is that in practice a single design has to take account of various differences across sites, such as differences in sample sizes, assignment probabilities, or expectations. The design below shows how these multisite features can be introduced in a simple way as part of a single “meta-design.” The design allows for variation across sites, implements analysis separately using data from different sites, and then combines findings for an overall conclusion. Note that the inquiries here are defined by creating site level inquiries and the averaging over these. Implicitly each <em>site</em> is weighted equally in the inquiry. Written like this you can see a clear similarity between <em>I</em> and <em>A</em>. One could alternatively use different weighting schemes if you wanted each unit in the sample to to have equal weight or if you wanted each each unit in the population to have equal weight—and of course, adjust <em>A</em> accordingly.</p>
<p>We imagine two possible treatments that might be implemented in each site. One, with treatment effect <code>tau_1</code> (possibly different in each site), is the treatment that researchers are meant to coordinate on. The second, with treatment effect <code>tau_2</code> is the treatment that researchers could implement if they were not coordinating. We imagine that if there is not strong coordination then researchers they select which version of the treatment to implement (here, we imagine they implement the treatment they think will yield larger effects).</p>
<p>We specify two inquiries. The first is for the coordinated treatment, with a focus on the average effect across studies. The second is less easy to describe: it is the average effect, again across cases, of whatever treatment was implemented in those cases. Though unusual, this inquiry is still well defined.</p>
<p>Estimation proceeds in two steps: first we calculate site-level effects, just as we do for a meta-analysis, then we meta-analyze those site-level effects. We use here a random effects model, reflecting our expectation that true site effects differ <a href="#sec-ch19s3">see&nbsp;<span>19.3</span></a>.</p>
<div id="def-ch19num4" class="declaration theorem definition">
<p><span class="theorem-title"><strong>Declaration 19.4 </strong></span>Multi-site studies with and without coordination</p>
<div class="cell" data-file="scripts_declarations/declaration_19.4.R">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.metafor-project.org">metafor</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Idiosyncratic features of studies</span></span>
<span><span class="va">study_sizes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">1000</span>, <span class="fl">1500</span>, <span class="fl">2000</span>, <span class="fl">2500</span><span class="op">)</span></span>
<span><span class="va">study_assignment_probabilities</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.6</span>, <span class="fl">0.7</span>, <span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="va">study_intercepts</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span></span>
<span><span class="va">study_priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">0.3</span>, length <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">study_coordination</span> <span class="op">&lt;-</span> <span class="st">"high"</span></span>
<span></span>
<span><span class="co"># helper function to estimate study level effects</span></span>
<span><span class="va">declaration_19.4</span> <span class="op">&lt;-</span></span>
<span>  </span>
<span>  <span class="fu">declare_model</span><span class="op">(</span></span>
<span>    sites <span class="op">=</span> <span class="fu">add_level</span><span class="op">(</span></span>
<span>      N <span class="op">=</span> <span class="fl">5</span>,</span>
<span>      size <span class="op">=</span> <span class="va">study_sizes</span>,</span>
<span>      intercept <span class="op">=</span> <span class="va">study_intercepts</span>,</span>
<span>      tau_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">study_priors</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>      tau_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>      coordination <span class="op">=</span> <span class="va">study_coordination</span>,</span>
<span>      <span class="co"># if coordinated, take tau_1, otherwise take the bigger of the two</span></span>
<span>      tau <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">coordination</span> <span class="op">==</span> <span class="st">"high"</span>,</span>
<span>                    <span class="va">tau_1</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">pmax</a></span><span class="op">(</span><span class="va">tau_1</span>, <span class="va">tau_2</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    subjects <span class="op">=</span> <span class="fu">add_level</span><span class="op">(</span></span>
<span>      N <span class="op">=</span> <span class="va">size</span>, </span>
<span>      U <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">declare_model</span><span class="op">(</span></span>
<span>    <span class="fu">potential_outcomes</span><span class="op">(</span></span>
<span>      <span class="va">Y</span> <span class="op">~</span> <span class="va">intercept</span> <span class="op">+</span> <span class="va">tau</span> <span class="op">*</span> <span class="va">Z_implemented</span> <span class="op">+</span> <span class="va">U</span>, </span>
<span>      conditions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Z_implemented <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">potential_outcomes</span><span class="op">(</span></span>
<span>      <span class="va">Y</span> <span class="op">~</span> <span class="va">intercept</span> <span class="op">+</span> <span class="va">tau_1</span> <span class="op">*</span> <span class="va">Z_common</span> <span class="op">+</span> <span class="va">U</span>, </span>
<span>      conditions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Z_common <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="fu">declare_inquiries</span><span class="op">(</span>handler <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">group_by</span><span class="op">(</span><span class="va">sites</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">summarize</span><span class="op">(</span></span>
<span>        ATE_implemented_site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Y_Z_implemented_1</span> <span class="op">-</span> <span class="va">Y_Z_implemented_0</span><span class="op">)</span>,</span>
<span>        ATE_common_site <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Y_Z_common_1</span> <span class="op">-</span> <span class="va">Y_Z_common_0</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu">summarize</span><span class="op">(</span>ATE_implemented <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ATE_implemented_site</span><span class="op">)</span>,</span>
<span>                ATE_common <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ATE_common_site</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">everything</span><span class="op">(</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"inquiry"</span>, values_to <span class="op">=</span> <span class="st">"estimand"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  </span>
<span>  <span class="fu">declare_assignment</span><span class="op">(</span></span>
<span>    Z_implemented <span class="op">=</span> <span class="fu">block_ra</span><span class="op">(</span></span>
<span>      blocks <span class="op">=</span> <span class="va">sites</span>,</span>
<span>      block_prob <span class="op">=</span> <span class="va">study_assignment_probabilities</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">declare_measurement</span><span class="op">(</span>Y <span class="op">=</span> <span class="fu">reveal_outcomes</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">Z_implemented</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">declare_step</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">data</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">group_by</span><span class="op">(</span><span class="va">sites</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">summarize</span><span class="op">(</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="fu">lm_robust</span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">Z_implemented</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"Z_implemented"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span> <span class="op">+</span></span>
<span>  </span>
<span>  <span class="fu">declare_estimator</span><span class="op">(</span></span>
<span>    yi <span class="op">=</span> <span class="va">estimate</span>,</span>
<span>    sei <span class="op">=</span> <span class="va">std.error</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"REML"</span>,</span>
<span>    .method <span class="op">=</span> <span class="va">rma_helper</span>,</span>
<span>    .summary <span class="op">=</span> <span class="va">rma_mu_tau</span>,</span>
<span>    term <span class="op">=</span> <span class="st">"mu"</span>,</span>
<span>    inquiry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ATE_implemented"</span>, <span class="st">"ATE_common"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">design_high_coordination</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">redesign</span><span class="op">(</span><span class="va">declaration_19.4</span>, study_coordination <span class="op">=</span> <span class="st">"high"</span><span class="op">)</span></span>
<span><span class="va">design_low_coordination</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">redesign</span><span class="op">(</span><span class="va">declaration_19.4</span>, study_coordination <span class="op">=</span> <span class="st">"low"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="lem-ch19num4" class="theorem lemma">
<p><span class="theorem-title"><strong>Diagnosis 19.4 </strong></span>Multi-site studies diagnosis</p>
<p>We now diagnose the two designs, with and without coordination, and assess the bias for the average common effect treatment and the average effect of the site-specific optimal treatment inquiries. <a href="#fig-ch19num6">Figure&nbsp;<span>19.6</span></a> displays the sampling distribution of the estimates from the two designs along with the estimands from these two inquiries in each case.</p>
<div id="fig-ch19num6" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="../figures/figure-19-6.svg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;19.6: Sampling distribution of the meta-analytic estimates from a multi-site trial compared to the true average common treatment effect and the true average effect of the site-specific optimal treatment effect.</figcaption></figure>
</div>
<p>In the coordinated trial, of course, the common treatment and the implemented treatment are the same. Only the coordinated study produces unbiased estimates for the coordinated inquiry. However the diagnosis shows that <em>both</em> approaches (strongly and weakly coordinated trials) are unbiased for the (more powerful) “selected treatment” inquiry. This inquiry then is well defined and can be estimated without bias. The difficulty with this inquiry though is that being able to make an out-of-sample predictions for this inquiry requires information you might not have: what version of a treatment is likely to be selected in that new context.</p>
</div>
<section id="design-examples-3" class="level3" data-number="19.4.1"><h3 data-number="19.4.1" class="anchored" data-anchor-id="design-examples-3">
<span class="header-section-number">19.4.1</span> Design examples</h3>
<ul>
<li><p><span class="citation" data-cites="Dunning2019">Dunning et al. (<a href="../references.html#ref-Dunning2019" role="doc-biblioref">2019</a>)</span> present the results of a “Metaketa” study (a term for coordinated multi site studies) of the effects of voter information campaigns on political accountability in five countries: Benin, Burkina Faso, Brazil, Uganda (two studies), and Mexico.</p></li>
<li><p>Coordinated multi-site studies need not be enormously expensive undertakings. <span class="citation" data-cites="frederiksen_2022">Frederiksen (<a href="../references.html#ref-frederiksen_2022" role="doc-biblioref">2022</a>)</span> reports the results of the same conjoint survey experiment measuring the effects of undemocratic behavior on electoral support in five countries (the United States, the United Kingdom, the Czech Republic, Mexico, and South Korea)</p></li>
</ul>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-Bauer2021" class="csl-entry" role="listitem">
Bauer, Paul C., and Bernhard Clemm von Hohenberg. 2021. <span>“Believing and Sharing Information by Fake Sources: An Experiment.”</span> <em>Political Communication</em> 38 (6): 647–71.
</div>
<div id="ref-blair_christensen_rudkin_2021" class="csl-entry" role="listitem">
Blair, Graeme, Darin Christensen, and Aaron Rudkin. 2021. <span>“Do Commodity Price Shocks Cause Armed Conflict? A Meta-Analysis of Natural Experiments.”</span> <em>American Political Science Review</em> 115 (2): 709–16.
</div>
<div id="ref-borenstein2021introduction" class="csl-entry" role="listitem">
Borenstein, Michael, Larry V Hedges, Julian PT Higgins, and Hannah R Rothstein. 2021. <em>Introduction to Meta-Analysis</em>. John Wiley &amp; Sons.
</div>
<div id="ref-Dunning2019" class="csl-entry" role="listitem">
Dunning, Thad, Guy Grossman, Macartan Humphreys, Susan D. Hyde, Craig McIntosh, Gareth Nellis, Claire L. Adida, et al. 2019. <span>“Voter Information Campaigns and Political Accountability: Cumulative Findings from a Preregistered Meta-Analysis of Coordinated Trials.”</span> <em>Science Advances</em> 5 (7): 1–10.
</div>
<div id="ref-francois2015power" class="csl-entry" role="listitem">
Francois, Patrick, Ilia Rainer, and Francesco Trebbi. 2015. <span>“How Is Power Shared in Africa?”</span> <em>Econometrica</em> 83 (2): 465–503.
</div>
<div id="ref-frederiksen_2022" class="csl-entry" role="listitem">
Frederiksen, Kristian Vrede Skaaning. 2022. <span>“Does Competence Make Citizens Tolerate Undemocratic Behavior?”</span> <em>American Political Science Review</em>, 1–7.
</div>
<div id="ref-Frey2022" class="csl-entry" role="listitem">
Frey, Anderson, Gabriel López-Moctezuma, and Sergio Montero. 2022. <span>“Sleeping with the Enemy: Effective Representation Under Dynamic Electoral Competition.”</span> <em>American Journal of Political Science</em>.
</div>
<div id="ref-galos_coppock_2022" class="csl-entry" role="listitem">
Galos, Diana, and Alexander Coppock. 2022. <span>“What Have Employment Audits Taught Us about the Effects of Gender on Hiring? A Meta-Analyis.”</span> <em>Unpublished Manuscript</em>.
</div>
<div id="ref-green2022using" class="csl-entry" role="listitem">
Green, Jon, James N. Druckman, Matthew A. Baum, David Lazer, Katherine Ognyanova, Matthew Simonson, Jennifer Lin, Mauricio Santillana, and Roy H. Perlis. 2022. <span>“Using General Messages to Persuade on a Politicized Scientific Issue.”</span> <em>British Journal of Political Science</em>.
</div>
<div id="ref-king1998unifying" class="csl-entry" role="listitem">
King, Gary. 1998. <em>Unifying Political Methodology: The Likelihood Theory of Statistical Inference</em>. Ann Arbor, Michigan: University of Michigan Press.
</div>
<div id="ref-paluck_green_green_2019" class="csl-entry" role="listitem">
Paluck, Elizabeth Levy, Seth A. Green, and Donald P. Green. 2019. <span>“The Contact Hypothesis Re-Evaluated.”</span> <em>Behavioural Public Policy</em> 3 (2): 129–58.
</div>
<div id="ref-Pettigrew:2006th" class="csl-entry" role="listitem">
Pettigrew, Thomas F., and Linda R. Tropp. 2006. <span>“A Meta-Analytic Test of Intergroup Contact Theory.”</span> <em>Journal of Personality and Social Psychology</em> 90 (5): 751–83.
</div>
<div id="ref-reiss2007structural" class="csl-entry" role="listitem">
Reiss, Peter C, and Frank A Wolak. 2007. <span>“Structural Econometric Modeling: Rationales and Examples from Industrial Organization.”</span> <em>Handbook of Econometrics</em> 6: 4277–4415.
</div>
<div id="ref-rubinstein1982perfect" class="csl-entry" role="listitem">
Rubinstein, Ariel. 1982. <span>“Perfect Equilibrium in a Bargaining Model.”</span> <em>Econometrica: Journal of the Econometric Society</em>, 97–109.
</div>
<div id="ref-Samii2016" class="csl-entry" role="listitem">
Samii, Cyrus. 2016. <span>“Causal Empiricism in Quantitative Research.”</span> <em>The Journal of Politics</em> 78 (3): 941–55.
</div>
<div id="ref-schwarz_coppock_2020" class="csl-entry" role="listitem">
Schwarz, Susanne, and Alexander Coppock. 2022. <span>“<span class="nocase">What Have We Learned About Gender From Candidate Choice Experiments? A Meta-analysis of 67 Factorial Survey Experiments</span>.”</span> <em>Journal of Politics</em> 84 (2): 655–68.
</div>
<div id="ref-wager2018estimation" class="csl-entry" role="listitem">
Wager, Stefan, and Susan Athey. 2018. <span>“Estimation and Inference of Heterogeneous Treatment Effects Using Random Forests.”</span> <em>Journal of the American Statistical Association</em> 113 (523): 1228–42.
</div>
<div id="ref-white1982maximum" class="csl-entry" role="listitem">
White, Halbert. 1982. <span>“Maximum Likelihood Estimation of Misspecified Models.”</span> <em>Econometrica: Journal of the Econometric Society</em> 50 (1): 1–25.
</div>
<div id="ref-wilke2020field" class="csl-entry" role="listitem">
Wilke, Anna M., and Macartan Humphreys. 2020. <span>“Field Experiments, Theory, and External Validity.”</span> SAGE Handbook of Research Methods in Political Science; International Relations.
</div>
</div>
</section></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>Not all variation in estimates across sites is due to differences in true effects. Different studies employ different data strategies, so some differences in the treatments and outcomes are inevitable. If the differences across studies grow too large, meta-analysis on the full set of studies becomes inappropriate.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../library/experimental-causal.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Experimental : causal</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../lifecycle/" class="pagination-link">
        <span class="nav-page-text">Research design lifecycle</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>